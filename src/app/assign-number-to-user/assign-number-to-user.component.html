<div class="container_1 mt-4">
  <h2 class="mb-4">Asignar Número de Sorteo a un Usuario</h2>
  <div class="row">
    <div class="col-md-2">
      <form [formGroup]="assignForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="clientId">Cliente</label>
          <select id="clientId" formControlName="clientId" (change)="onClientChange($event)" class="form-control" [class.is-invalid]="assignForm.get('clientId')?.invalid && assignForm.get('clientId')?.touched">
            <option value="">Seleccione un cliente</option>
            <option *ngFor="let client of clients || []" [value]="client.idClient">{{ client.name }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="assignForm.get('clientId')?.invalid && assignForm.get('clientId')?.touched">
            Por favor, seleccione un cliente.
          </div>
        </div>

        <div class="form-group">
          <label for="searchUser">Buscar Usuario</label>
          <form [formGroup]="searchForm">
            <input type="text" id="searchUser" formControlName="searchTerm" class="form-control" placeholder="Buscar un usuario...">
          </form>
        </div>

        <div class="form-group">
          <label for="userId">Usuario</label>
          <select id="userId" formControlName="userId" class="form-control" [class.is-invalid]="assignForm.get('userId')?.invalid && assignForm.get('userId')?.touched">
            <option value="">Seleccione un usuario</option>
            <option *ngFor="let user of filteredUsers || []" [value]="user.idUser">{{ user.name }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="assignForm.get('userId')?.invalid && assignForm.get('userId')?.touched">
            Por favor, seleccione un usuario.
          </div>
        </div>

        <div class="form-group">
          <label for="raffleId">Sorteo</label>
          <select id="raffleId" formControlName="raffleId" class="form-control" [class.is-invalid]="assignForm.get('raffleId')?.invalid && assignForm.get('raffleId')?.touched">
            <option value="">Seleccione un sorteo</option>
            <option *ngFor="let raffle of raffles || []" [value]="raffle.idRaffle">{{ raffle.name }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="assignForm.get('raffleId')?.invalid && assignForm.get('raffleId')?.touched">
            Por favor, seleccione un sorteo.
          </div>
        </div>

        <div class="form-group buttons">
          <button type="submit" class="btn btn-primary me-2" [disabled]="!assignForm.valid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
            Asignar Número
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()" [disabled]="isLoading">Reiniciar</button>
        </div>
      </form>

      <div *ngIf="assignedNumber" class="alert alert-success mt-3">
        <p class="mb-0">Número Asignado: <strong>{{ assignedNumber }}</strong></p>
      </div>
      <div *ngIf="error" class="alert alert-danger mt-3">
        <p class="mb-0">{{ error }}</p>
      </div>
    </div>
    <div class="col-md-9">
      <h3>Usuarios Filtrados</h3>
      <ul class="list-group">
        <li *ngFor="let user of filteredUsers || []" class="list-group-item">
          {{ user.name }}
        </li>
      </ul>
      <p *ngIf="filteredUsers.length === 0" class="mt-3">No se encontraron usuarios que coincidan con los criterios de búsqueda.</p>
    </div>
  </div>
</div>

